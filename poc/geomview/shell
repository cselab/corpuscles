awk -v p=x.$$ \
'
BEGIN {
    system("rm -f o; mkfifo o")
    system("rm -f i; mkfifo i")
    cmd = "cat >i <o &"
    r = system(cmd)
    print r
    pr()
}
{
    print $0 > "o"
    getline l < "i"
    pr()
}

function pr() { printf "> " }

'
